/*! Coolony's Kiwi | Copyright Â©2012 Pierre Matri <pierre.matri@coolony.com> | MIT Licensed */
(function(){function a(b){var c=a.resolve(b),d=a.modules[c];if(!d)throw new Error('failed to require "'+b+'"');return d.exports||(d.exports={},d.call(d.exports,d,d.exports,a.relative(c))),d.exports}a.modules={},a.resolve=function(b){var c=b,d=b+".js",e=b+"/index.js";return a.modules[d]&&d||a.modules[e]&&e||c},a.register=function(b,c){a.modules[b]=c},a.relative=function(b){return function(c){if("."!=c.charAt(0))return a(c);var d=b.split("/"),e=c.split("/");d.pop();for(var f=0;f<e.length;f++){var g=e[f];".."==g?d.pop():"."!=g&&d.push(g)}return a(d.join("/"))}},a.register("cache.js",function(a,b,c){function d(){this._cache={}}d.prototype.cache=function(a,b){if(_.isUndefined(b))return;this._cache[a]=b},d.prototype.get=function(a){return this._cache[a]},a.exports=b=d}),a.register("compiler.js",function(a,b,c){var d=c("./token"),e=c("./utils"),f="{{",g="}}",h=f.length,i=/^(\/)?\s*([^\s\}\(]*)/,j=a.exports=function(a){this.template=a,this.source=a.template,this.options=a.options,this.helpers={},this.__compilationEnd=[]};j.prototype.compile=function(a){function c(c,d){if(c)return a(c);b._tokenize(d,f)}function f(c,d){if(c)return a(c);d.compile(b,g)}function g(c,d){if(c)return a(c);var e=new Function("__template","__tools","_","__data","__helpers","__callback",d);e.__helpers=b.helpers,a(null,e)}var b=this;e.applyAll(this.source,d.tagBeforeProcessors,[this],c)},j.prototype._tokenize=function(a,b){var c=a,e=new d.RootToken,i=e,j=!1,k;for(;;){var l=c.search(j?g:f);if(l==-1){this._pushLiteralToken(i,e,c);break}j&&(l+=h),k=c.slice(0,l),c=c.slice(l);if(!j)this._pushLiteralToken(i,e,k);else{k=k.slice(2,-2);try{e=this._pushToken(i,e,k)}catch(m){return b(m)}}j=!j}if(i!==e)return b(new Error("Tokenization error: unexpected end of file, expected `"+e.tag.tagName+"`."));b(null,i)},j.prototype._pushLiteralToken=function(a,b,c){if(!c.length)return;b.children.push(new d.LiteralToken(c,a))},j.prototype._pushToken=function(a,b,c){var e=c.match(i),f=e[2],g=e[1]!=="/",h=b.lookupTag(f);if(!h)throw new Error("Tokenization error: Unknown tag `"+f+"`.");if(h.isIntermediate){b.tagType.isIntermediate&&(b=b.parent);var j=new d.IntermediateToken(c,h,a,b,[],this.options);return b.intermediate.push(j),j}if(h.isBlock){if(g){var j=new d.BlockToken(c,h,a,b,[],this.options);return b.children.push(j),j}if(!b.parent)throw new Error("Tokenization error: unexpected `"+f+"` tag at root level.");b.tagType.isIntermediate&&(b=b.parent);if(b.tagType.tagName!==f)throw new Error("Tokenization error: unexpected `"+f+"` tag, expected `"+b.tag.tagName+"`.");return b.parent}if(!g)throw new Error("Tokenization error: `"+f+"` is not a block tag.");var j=new d.LeafToken(c,h,a,b,this.options);return b.children.push(j),b},j.prototype.registerTemplateHelper=function(a,b){this.helpers[a]=b}}),a.register("filter.js",function(a,b,c){function d(b,c){var d;c.forEach(function(c){var e=[];_.isArray(c)&&(e=c.slice(1),c=c[0]);var f=a.exports.filters[c];if(!f)return d=c,!1;b=f.apply(this,[b].concat(e))});if(d)throw new Error("Rendering error: Unknown filter `"+d+"`.");return b}function f(a){a=a||frame.files.requireDir(__dirname+"/filters/");for(file in a){var b=a[file];for(d in b)e[d]=b[d]}}a.exports=d;var e=a.exports.filters={},g=["base","datetime"],h={};_.each(g,function(a){h[a]=c("./filters/"+a)}),f(h)}),a.register("filters/base.js",function(a,b,c){var d=c("../tools"),e=c("../utils");b.escape=function(a){if(a===null||a===undefined)return"";if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.escape(a)}),c}return d.escape(a)},b.escapeIfUnsafe=function(a){if(a===null||a===undefined)return"";if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.escapeIfUnsafe(a)}),c}return d.escapeIfUnsafe(a)},b.capitalize=function(a){if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.capitalize(a)}),c}return a=a.toString(),a.charAt(0).toUpperCase()+a.slice(1)},b.upper=function(a){if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.upper(a)}),c}return a.toString().toUpperCase()},b.lower=function(a){if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.lower(a)}),c}return a.toString().toLowerCase()},b.json=function(a){return JSON.stringify(a)},b.add=function(a,c){if(typeof a=="object"){var d={};return _.each(a,function(a,e){d[e]=b.add(a,c)}),d}return parseFloat(a)+parseFloat(c)},b.subtract=function(a,c){return b.add(a,-parseInt(c))},b.mul=function(a,c){if(typeof a=="object"){var d={};return _.each(a,function(a,e){d[e]=b.mul(a,c)}),d}return parseFloat(a)*parseFloat(c)},b.div=function(a,c){if(typeof a=="object"){var d={};return _.each(a,function(a,e){d[e]=b.div(a,c)}),d}return parseFloat(a)/parseFloat(c)},b.incr=function(a,c){return b.add(a,1)},b.decr=function(a,c){return b.add(a,-1)},b.round=function(a){if(typeof a=="object"){var c={};return _.each(a,function(a,d){c[d]=b.round(a,operand)}),c}return Math.round(a)},b.floor=function(a){if(typeof a=="object"){var c={};return _.each(a,function(a,d){c[d]=b.floor(a,operand)}),c}return Math.floor(a)},b.ceil=function(a){if(typeof a=="object"){var c={};return _.each(a,function(a,d){c[d]=b.ceil(a,operand)}),c}return Math.ceil(a)},b.cut=function(a,c){if(typeof a=="object"){var d={};return _.each(a,function(a,e){d[e]=b.cut(a,c)}),d}return a.toString().replace(c,"")},b.addslashes=function(a){if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.capitalize(a)}),c}return a.toString().replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"').replace(/\0/g,"\\0")},b.stripslashes=function(a){if(e.isIterable(a)){var c={};return _.each(a,function(a,d){c[d]=b.capitalize(a)}),c}return a.toString().replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\0/g,"\0").replace(/\\\\/g,"\\")},b.first=function(a){return typeof a=="object"&&!_.isArray(a)?"":_.isString(a)?a.substr(0,1):_.first(a)},b.last=function(a){return typeof a=="object"&&!_.isArray(a)?"":_.isString(a)?a.slice(-1):_.last(a)},b.length=function(a){return typeof a=="object"?_.keys(a).length:a.length},b.reverse=function(a){return _.isArray(a)?a.reverse():a},b.join=function(a,b){if(_.isArray(a))return a.join(b);if(typeof a=="object"){var c=[];return _.each(a,function(a,b){c.push(a)}),c.join(b)}return a},b.urlencode=function(a){return encodeURIComponent(a)},b.urldecode=function(a){return decodeURIComponent(a)},b.replace=function(a,b,c,d){return a.replace(new RegExp(b,d),c)},a.exports=b}),a.register("filters/datetime.js",function(a,b,c){b.timeago=function(a){return moment(a).fromNow()},b.relativedate=function(a){return moment(a).calendar()},b.date=function(a,b){return moment(a).format(b)},a.exports=b}),a.register("kiwi.js",function(a,b,c){var d=b.Template=c("./template");b.tools=c("./tools"),b.version="0.1.2",a.exports=b}),a.register("tags/as.js",function(a,b,c){var d=/^as\s+([^\s]+)$/;a.exports.tags={};var e=a.exports.tags.as={};e.isBlock=!0,e.compile=function(a,b,c,e,f){var g=a.tag.match(d);if(!g)return f(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var h=g[1],i="(function(parentAcc) {var __acc = [];"+b+'var __joined = __acc.join("");'+'__data["'+h+'"] = __tools.tools.safe(__joined);'+"})(__acc);";f(null,i)}}),a.register("tags/block.js",function(a,b,c){var d=/^block\s+([^\s]+)(?:\s+(append|prepend))?$/;a.exports.tags={};var e=a.exports.tags.block={},f=a.exports.tags.parent={};e.isBlock=!0,e.compile=function(a,b,c,e,f){var g=a.tag.match(d);if(!g)return f(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var h=g[1],i=g[2],j="(function(parentAcc) {var __acc = [];"+b+'var __currentBlock = __acc.join("");'+'if(!_.isUndefined(__blocks["'+h+'"])) {'+'__tmp = new String(__blocks["'+h+'"].replace('+'"{{parent}}", __currentBlock'+"));"+'if(__blocks["'+h+'"].mode) {'+'__tmp.mode = __blocks["'+h+'"].mode;'+"}"+'__blocks["'+h+'"] = __tmp;'+"}"+"var __acc = [];"+'if(_.isUndefined(__blocks["'+h+'"]) || __blocks["'+h+'"].mode) {'+'if(__blocks["'+h+'"] && __blocks["'+h+'"].mode == "append") {'+'__acc.push(__blocks["'+h+'"]);'+"}"+"__acc.push(__currentBlock);"+'if(__blocks["'+h+'"] && __blocks["'+h+'"].mode == "prepend") {'+'__acc.push(__blocks["'+h+'"]);'+"}"+"} else {"+'__acc.push(__blocks["'+h+'"]);'+"}"+'var __joined = new String(__acc.join(""));'+(i?'__joined.mode = "'+i+'";':"")+"parentAcc.push(__joined);"+'__blocks["'+h+'"] = __joined;'+"})(__acc);";f(null,j)},f.compile=function(a,b,c,d){if(a.parent.tagType.tagName!=="block")return d(new Error("Compilation error: `parent` tag should be immediate child of a `block` tag."));a.parent.hasParentTag=!0,d(null,'__acc.push("{{parent}}");')}}),a.register("tags/comment.js",function(a,b,c){var d=/\{\{\s*comment\s*\}\}((.|\n)*?)\{\{\s*\/\s*comment\s*\}\}/g;a.exports.tags={};var e=a.exports.tags["#"]={};e.isBlock=!1,e.compile=function(a,b,c,d){d(null,"")},e.beforeProcessor=function(a,b,c){a=a.replace(d,""),c(null,a)}}),a.register("tags/each.js",function(a,b,c){var d=/^each(?:\(([^\)\s]+)\s*\,\s*([^\)\s]+)\s*\))?\s+(.*)$/;a.exports.tags={};var e=a.exports.tags.each={},f=e.intermediateTags={},g=f.empty={};e.isBlock=!0,e.headDeclarations="var _eachLoop;",e.compile=function(a,b,c,e,f){var g=a.tag.match(d);if(!g)return f(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var h=g[1]||"$value",i=g[2]||"$index",j=g[3],k;if(c.length){if(c.length>1)return f(new Error("Compilation Error: Too many intermediate tags for `each`."));if(a.intermediate[0].tag!=="empty")return f(new Error("Compilation Error: Unexpected tag `"+a.intermediate[0].tag+"`."));k=c[0]}var l="(function(__parentEachLoop) {";a.options.strict?l+="__tmp = "+j+";":l+="try {__tmp = "+j+"} catch(__err) {"+"if(__err instanceof ReferenceError) {"+"__tmp = [];"+"} else {"+"throw __err;"+"}"+"}",l+="var __eachLoopLength = _.size(__tmp);",k&&(l+="if(__eachLoopLength) {"),a.options.eachCounters?l+="var __eachLoopCounter = 0;_.each(__tmp, function("+h+","+i+"){"+"_eachLoop = {"+"size: __eachLoopLength,"+"counter0: __eachLoopCounter,"+"counter: __eachLoopCounter + 1,"+"revcounter0: __eachLoopLength - __eachLoopCounter - 1,"+"revcounter: __eachLoopLength - __eachLoopCounter,"+"first: __eachLoopCounter === 0,"+"last: __eachLoopCounter + 1 === __eachLoopLength,"+"parentLoop: __parentEachLoop"+"};"+b+"__eachLoopCounter++;"+"});":l+="_.each(__tmp, function("+h+","+i+"){"+b+"});",k&&(l+="} else {"+k+"}"),l+="})(_eachLoop);",f(null,l)}}),a.register("tags/extend.js",function(a,b,c){var d=c("../utils"),e=/^extend\s+(.+)$/;a.exports.tags={};var f=a.exports.tags.extend={},g=a.exports.helpers={};f.isBlock=!1,f.compile=function(a,b,c,d){if(a.root.children[0]!==a)return d(new Error("Compilation error: Extend tag must be defined at the very beginning of the template."));var f=a.tag.match(e);if(!f)return d(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var g=f[1],h="var __originalCallback = __callback;__callback = function(err, compiled) {__helpers.extend("+g+", __compiled, __template,"+"__data, __originalCallback);"+"};";d(null,h)},g.extend=function(a,b,c,d,e){function f(a,b){if(a)return e(a);e(null,b)}c._renderRelative(a,d,b,f)}}),a.register("tags/if.js",function(a,b,c){function i(a,b){var c;return b?c="if("+a+")":c="try {__tmp = "+a+"} catch(__err) {"+"if(__err instanceof ReferenceError) {"+"__tmp = false;"+"} else {"+"throw __err;"+"}"+"}"+"if(__tmp)",c}var d=/^if\s+(.*)$/,e=/^else(?:\s+(.*))?$/;a.exports.tags={};var f=a.exports.tags["if"]={},g=f.intermediateTags={},h=g["else"]={};f.isBlock=!0,f.compile=function(a,b,c,f,g){var h=a.tag.match(d);if(!h)return g(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var j=h[1],k=["}"],l=i(j,a.options.strict);l+="{"+b;var m;_.each(a.intermediate,function(b,d){var f=b.tag,g=c[d],h=f.match(e);if(!h){m=new Error("Compilation error: Unable to parse tag `"+a.tag+"`.");return}var j=h[1];j?(k.push("}"),l+="} else {"+i(j,a.options.strict)+"{"):l+="} else {",l+=c[d]});if(m)return g(m);l+=k.join(""),g(null,l)}}),a.register("tags/ifblock.js",function(a,b,c){var d=/^ifblock\s+([^\s]+)$/;a.exports.tags={};var e=a.exports.tags.ifblock={};e.isBlock=!0,e.compile=function(a,b,c,e,f){var g=a.tag.match(d);if(!g)return f(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var h=g[1],i='if(!_.isUndefined(__blocks["'+h+'"])) {'+b+"}";f(null,i)}}),a.register("tags/include.js",function(a,b,c){var d=c("../utils"),e=/^include\s+(.+)$/;a.exports.tags={};var f=a.exports.tags.include={},g=a.exports.helpers={};f.isBlock=!1,f.compile=function(a,b,c,d){var f=a.tag.match(e);if(!f)return d(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var g=f[1];c.__compilationEnd.unshift("});");var h="__helpers.include("+g+", __template,"+"__data, function(err, rendered) {"+"__acc.push(rendered);";d(null,h)},g.include=function(a,b,c,d){function e(a,b){if(a)return d(a);d(null,b)}b._renderRelative(a,c,null,e)}}),a.register("tags/print.js",function(a,b,c){function n(a){var b=function(b,c,d,e){var g=b.tag.match(f);if(!g)return e(new Error("Compilation error: Unable to parse tag `"+b.tag+"`."));if(g[1]){var h=parseInt(g[1])-1;b.__originalTag=d.__print[h]}var i=g[2],j=g[3]?o(g[3],a):a,i="__tools.filter("+i+", "+"["+j.join(",")+"]"+")",k;b.options.strict?k="__acc.push("+i+");":k="try {var __tmp = "+i+";"+"} catch(__err) {"+"if(__err instanceof ReferenceError) {"+'__tmp = "";'+"} else {"+"throw __err;"+"}"+"}"+"__acc.push(__tmp);",e(null,k)};return b.untokenize=function(a,b){return a.__originalTag?a.__originalTag:"{{"+a.tag+"}}"},b}function o(a,b){var c=!1;return a=a.split(g).filter(function(b){return b=="raw"?(c=!0,!1):!0}).map(function(b){b=b.match(i),b[1]=b[1].replace('"','"');if(!b[2])return'"'+b[1]+'"';var c=b[2].split(h);return'["'+b[1]+'", '+c.join(",")+"]"}),c||(a=a.concat(b)),_.uniq(a)}var d=c("../filter"),e=/\$\{([^\}]*)\}/g,f=/^(?:=|html)\s+(?:\:(\d+)\s+)?([^|]+)(?:\|(.*))?$/,g=/\|(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/g,h=/\,(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/g,i=/^([a-z]+)\s*(?:\((.*)\))?$/i,j=["escapeIfUnsafe"].map(JSON.stringify),k=[];a.exports.tags={};var l=a.exports.tags["="]={},m=a.exports.tags.html={};l.isBlock=!1,m.isBlock=!1,l.beforeProcessor=function(a,b,c){b.__print=[],a=a.replace(e,function(a,c){return b.__print.push(a),"{{= :"+b.__print.length+" "+c+"}}"}),c(null,a)},l.compile=n(j),m.compile=n(k)}),a.register("tags/raw.js",function(a,b,c){var d=c("../utils"),e=/\{\{\s*verbatim\s*\}\}((?:.|\n)*?)\{\{\s*\/\s*verbatim\s*\}\}|{\{\s*raw\s*\}\}((?:.|\n)*?)\{\{\s*\/\s*raw\s*\}\}/g;a.exports.tags={};var f=a.exports.tags.verbatim={};f.isBlock=!1,f.compile=function(a,b,c,e){var f=parseInt(a.tag.split(" ")[1])-1;e(null,'__acc.push("'+d.escapeCompiledString(c.__verbatim[f])+'");')},f.beforeProcessorPrepend=!0,f.beforeProcessor=function(a,b,c){b.__verbatim=[],a=a.replace(e,function(c,d,e){return b.__verbatim.push(d||e),"{{verbatim "+b.__verbatim.length+"}}"}),c(null,a)}}),a.register("tags/tmpl.js",function(a,b,c){var d=c("../utils"),e=/^tmpl\s+(.*)$/;a.exports.tags={};var f=a.exports.tags.tmpl={};f.isBlock=!1,f.compile=function(a,b,c,d){var f=a.tag.match(e);if(!f)return d(new Error("Compilation error: Unable to parse tag `"+a.tag+"`."));var g=f[1];c.__compilationEnd.unshift("});"),d(null,"__template._nest("+g+", __data, "+"function(err, rendered){"+"__acc.push(rendered);")}}),a.register("template.js",function(a,b,c){function m(a,b){_.isObject(a)&&!b&&(b=a,a=null),b=b?_.clone(b):{},b=_.defaults(b,k),b.cacheContext=b.cacheContext||m,this.template=a,this.options=b,this._compiled=null;if(b.cache&&!(this._getCache()instanceof b.cacheHandler)){var c=[b.cacheHandler].concat(b.cacheOptions);b.cacheContext[b._cacheProp]=typeof window!="undefined"?new b.cacheHandler:construct.apply(this,c)}}var d=c("./cache"),e=d,f=c("./utils"),g=c("./token"),h=c("./tools"),i=c("./compiler"),j=c("./filter"),k={lookup:f.lookupTemplate,load:f.loadTemplate,path:null,cache:!0,cacheHandler:d,cacheOptions:[],lookupPaths:[],cacheTmplHandler:e,cacheTmplOptions:[1e3],useIsolatedTmplCache:!0,cacheContext:null,strict:!0,eachCounters:!0,_parent:null,_cacheAttachment:"_cache",_cacheTmplAttachment:"_nestCache"},l={filter:j,utils:f,tools:h};m.prototype._getCache=function(){return this.options.cacheContext[this.options._cacheProp]},m.prototype.loadFile=function(a,b){b(new Error("Client mode does not support reading from file."))},m.prototype.render=function(a,b){_.isFunction(a)&&!b&&(b=a,a={});var c="template::"+this._cacheKey();!this.compiled&&this.options.cache&&(this._compiled=this._getCache().get(c));if(this._compiled)return this._renderCompiled(a,b);var d=this;this._compile(function(c){if(c)return b(c);d._renderCompiled(a,b)})},m.prototype._renderCompiled=function(b,c){try{this._compiled.call(this._compiled,this,l,_,b,g.helpers,c)}catch(d){c(d)}},m.prototype._compile=function(a){var b=this;if(!_.isString(this.template))return a(new Error("Template contents not set"));(new i(this)).compile(function(c,d){if(c)return a(c);b._compiled=d;var e="template::"+b._cacheKey();b.options.cache&&b._getCache().cache(e,d),a(null,d)})},m.prototype._nest=function(a,b,c){var d=_.clone(this.options);d.useIsolatedTmplCache&&(d._cacheAttachment=d._cacheTmplAttachment,d.cacheHandler=d.cacheTmplHandler,d.cacheOptions=d.cacheTmplOptions),(new m(a,d)).render(b,function(b,d){if(b)return c(b);c(null,d)})},m.prototype._renderRelative=function(a,b,c,d){function j(a,b){if(a)return d(a);e.options.cache&&e._getCache().cache(h,b),g.loadFile(b,k)}function k(a,c){if(a)return d(a);g.render(b,l)}function l(a,b){if(a)return d(a);d(null,b)}var e=this,f=_.clone(this.options);f._parent=c;var g=new m(f),h="path::"+this._cacheKey()+"::"+a,i;this.options.cache&&(i=this._getCache().get(h)),i?g.loadFile(i,k):this.options.lookup(a,this,j)},m.prototype._cacheKey=function(){return this.options.path||this.template||null},b=a.exports=m}),a.register("token.js",function(a,b,c){function l(a,b,c){this.parent=b,this.children=[],this.tag=null,this.tagType=null,this.options=c,this.root=a}function m(a,b,c,d){m._superclass.call(this,b,c,d),this.literal=a}function n(a,b){n._superclass.call(this,this,null,b),a||(a=[]),this.head=[],this.children=a}function o(a,b,c,d,e,f){o._superclass.call(this,c,d,f),this.tag=a,this.tagType=b,e||(e=[]),this.children=e,this.intermediate=[]}function p(a,b,c,d,e){p._superclass.call(this,c,d,e),this.tag=a,this.tagType=b}function q(a,b,c,d,e,f){q._superclass.call(this,a,b,c,d,e,f)}function r(a,b){b.beforeProcessor&&(b.beforeProcessorPrepend?j.unshift(b.beforeProcessor):j.push(b.beforeProcessor)),b.headDeclarations&&g.push(b.headDeclarations),b.footDeclarations&&h.push(b.footDeclarations);if(b.helpers)for(helperName in b.helpers)s(helperName,b.helpers[helperName]);i[a]=b,b.tagName=a}function s(a,b){k[a]=b}function t(a){a=a||d.files.requireDir(__dirname+"/tags/");for(file in a){var b=a[file].tags,c=a[file].helpers;for(tag in b)r(tag,b[tag]);if(c)for(helperName in c)s(helperName,c[helperName])}}var d,e=c("./utils"),f=d?d.classes.extend:e.inherits,g=[],h=[],i={},j=[],k={};l.prototype.compile=function(a,b){b(new Error("Stub method BaseToken#compile must be overloaded"))},l.prototype.lookupTag=function(a){if(i[a])return i[a];if(this.tagType&&this.tagType.intermediateTags&&this.tagType.intermediateTags[a])return this.tagType.intermediateTags[a].isIntermediate=!0,this.tagType.intermediateTags[a]},f(m,l),m.prototype.compile=function(a,b){this._compiled='__acc.push("'+e.escapeCompiledString(this.literal)+'");',b(null,this._compiled)},f(n,l),n.prototype.compile=function(a,b){function d(d,e){if(d)return b(d);var e="var __this = this;var __acc = [];var __blocks = {};if(__template.options && __template.options._parent) {__blocks = __template.options._parent.blocks;}var __tmp;var __err;__data = __data || {};"+g.join("")+"with(__data) {"+e+h.join("")+'var __compiled = new String(__acc.join(""));'+"__compiled.blocks = __blocks;"+"__callback(null, __compiled);"+a.__compilationEnd.join("")+"}";c._compiled=e,b(null,e)}var c=this;e.compileTokens(this.children,a,d)},f(o,l),o.prototype.compile=function(a,b){function i(f,g){if(f)return b(f);d=g,e.compileTokenArray(c.intermediate,a,j)}function j(e,h){if(e)return b(e);f=h,g(c,d,f,a,k)}function k(a,d){if(a)return b(a);c._compiled=d,b(null,d)}var c=this,d,f,g=this.tagType.compile,h=g.joinCompilationResult!==!1?"compileTokens":"compileTokenArray";e[h](this.children,a,i)},f(p,l),p.prototype.compile=function(a,b){function d(a,d){if(a)return b(a);c._compiled=d,b(null,d)}var c=this,e=this.tagType.compile(this,null,a,d)},p.prototype.untokenize=function(a){return this.tagType.compile.untokenize?this.tagType.compile.untokenize(this,a):"{{"+this.tag+"}}"},f(q,o),q.prototype.compile=function(a,b){function d(a,c){if(a)return b(a);b(null,c)}var c=this;e.compileTokens(this.children,a,d)},q.prototype.lookupTag=function(a){return this.parent.lookupTag(a)},b=a.exports={headDeclarations:[],BaseToken:l,RootToken:n,BlockToken:o,IntermediateToken:q,LeafToken:p,LiteralToken:m,headDeclarations:g,footDeclarations:h,tags:i,tagBeforeProcessors:j,helpers:k,registerTag:r,registerHelper:s};var u=["block","comment","each","if","print","raw","tmpl","ifblock","as"],v={};_.each(u,function(a){v[a]=c("./tags/"+a)}),t(v)}),a.register("tools.js",function(a,b,c){var d=c("./token"),e=c("./filter"),f=c("./utils"),g=/\s+(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/g;b.createSimpleTag=function(b,c){d.helpers[b]=c,d.tags[b]={compile:function(a,c,d,e){var f=a.tag.split(g);f[0]="__data";var h=f.join(","),i='__acc.push(__tools.tools.escapeIfUnsafe(__helpers["'+b+'"]('+h+")"+"));";e(null,i)}}},b.createFilter=function(b,c){e.filters[b]=c};var h=b.escape=function(a){return a.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#146;")};b.safe=function(a){return a instanceof String||(a=new String(a)),a.safe=!0,a},b.escapeIfUnsafe=function(a){return a.safe?a:h(a)},b.registerTag=d.registerTag,b.registerHelper=d.registerHelpers,b.escapeCompiledString=f.escapeCompiledString,b.applyAll=f.applyAll,a.exports=b}),a.register("utils.js",function(a,b,c){function f(a,b,c,d){function e(b){if(b)return d(b);a.length>0?setTimeout(f,0):d()}function f(){var d=a.shift();b.apply(this,[d].concat(c).concat([e]))}typeof c=="function"&&!d&&(d=c,c=null),c||(c=[]),a=a.slice(0),a.length>0?setTimeout(f,0):d()}function i(a,b,c){function f(a,c){a.compile(b,function(b,e){if(b)return c(b);d.push(e),c(null,e)}),e++}function h(a){if(a)return c(a);c(null,d)}var d=[],e=0;g(a,f,h)}var d,e=".kiwi",g=d?d.asyncForEach:f,h=b.apply=function(a,b,c,d){function e(a,b){if(a)return d(a);d(null,b)}typeof c=="function"&&!d&&(d=c,c=null),b.apply(this,[a].concat(c||[]).concat([e]))};b.applyAll=function(a,b,c,d){function e(b,d){h(a,b,c||[],function(c,e){if(c)return d(c);a=e,d()})}function f(b){if(b)return d(b);d(null,a)}typeof c=="function"&&!d&&(d=c,c=null),g(b,e,f)},b.compileTokenArray=i,b.compileTokens=function(a,b,c){i(a,b,function(a,b){if(a)return c(a);c(null,b.join(""))})},b.escapeCompiledString=function(a){return a.replace(/([\\"])/g,"\\$1").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")},b.isIterable=function(a){return typeof a=="object"&&!(a instanceof String)},b.inherits=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a._superclass=b,a._superproto=b.prototype},a.exports=b}),window.kiwi=a("kiwi")})();